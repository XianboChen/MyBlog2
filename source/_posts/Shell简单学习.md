---
title: Shell简单学习
date: 2016-07-29 18:58:57
tags:
  - Shell
  - Tool
---
最近学习简单看了点shell脚本的语法，在此来记下与C、java语言不同的语法点，方便以后查看。
首先要明确两个概念：Shell脚本与Shell
[**Shell script（shell 脚本）**][1]，是一种电脑程序与文本文件，内容由一连串的shell命令组成，经由Unix Shell直译其内容后运作。被当成是一种脚本语言来设计，其运作方式与直译语言相当，由Unix shell扮演命令行解释器的角色，在读取shell script之后，依序运行其中的shell命令，之后输出结果。
[**Shell**][2],“为用户提供用户界面”的软件，通常指的是命令行界面的解析器。一般来说，这个词是指操作系统中，提供访问内核所提供之服务的程序。Shell也用于泛指所有为用户提供操作界面的程序，也就是程序和用户交互的层面。因此与之相对的是程序内核（Core），内核不提供和用户的交互功能。
我们一般称shell编程是指shell脚本的编程，不是指开发shell，这点概念要分清。
### 使用变量
使用一个定义过的变量，只要在变量名前面加美元符号($)即可:
```Bash
your_name="xianbo"
echo $your_name
```
执行的时候记得加上可执行权限
``` Bash
chmod +x ./test.sh  #使脚本具有执行权限
./test.sh  #执行脚本
```
运行结果：
> xianbo
### 获取字符串长度
```
string="abcd"
echo ${#string} #输出 4
```
### 数组
```
my_array=(A B "C" D)
echo "第一个元素为: ${my_array[0]}"
echo "第二个元素为: ${my_array[1]}"
echo "第三个元素为: ${my_array[2]}"
echo "第四个元素为: ${my_array[3]}"
```
运行结果：
> 
第一个元素为: A
第二个元素为: B
第三个元素为: C
第四个元素为: D

### 基本运算符
1.原生bash不支持简单的数学运算，但是可以通过其他命令来实现
```
val=`expr 2 + 2`
echo "两数之和为 : $val"
val=`expr $a \* $b`
echo "a * b : $val"
```
运行结果:
> 两数之和为 : 4
a * b : 200
这里要注意乘号*需要使用转移符

2.使用方括号与美元符的方式
```
a=$[2+2]
b=$[2 - 1]
c=$[2 / 2]
d=$[2 * 2]
echo $a $b $c $d
```
运行结果：
> 4 1 1 4
while语句
```
int=1
while(($int<=5 ))
do
        echo $int
        let "int++"
done
```
运行结果：
> 1
2
3
4
5

### Shell函数
```
funWithReturn(){
    echo "这个函数会对输入的两个数字进行相加运算..."
    echo "输入第一个数字: "
    read aNum
    echo "输入第二个数字: "
    read anotherNum
    echo "两个数字分别为 $aNum 和 $anotherNum !"
    return $(($aNum+$anotherNum))
}
funWithReturn
echo "输入的两个数字之和为 $? !"
```
运行结果:
> 这个函数会对输入的两个数字进行相加运算...
输入第一个数字: 
1
输入第二个数字: 
3
两个数字分别为 1 和 3 !
输入的两个数字之和为 4 !

**说明：**

-  可以带function fun() 定义，也可以直接fun() 定义,不带任何参数。
-  参数返回，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。
-  函数返回值在调用该函数后通过 $? 来获得。
- 所有函数在使用前必须定义。这意味着必须将函数放在脚本开始部分，直至shell解释器首次发现它时，才可以使用。调用函数仅使用其函数名即可。

### 参数函数
在Shell中，调用函数时可以向其传递参数。在函数体内部，通过$n的形式来获取参数的值，例如，$1表示第一个参数，$2表示第二个参数...以此类推
```
funWithParam(){
    echo "第一个参数为 $1 !"
    echo "第二个参数为 $2 !"
    echo "第十个参数为 $10 !"
    echo "第十个参数为 ${10} !"
    echo "第十一个参数为 ${11} !"
    echo "参数总数有 $# 个!"
    echo "作为一个字符串输出所有参数 $* !"
}
funWithParam 1 2 3 4 5 6 7 8 9 34 73
```
运行结果：
> 第一个参数为 1 !
第二个参数为 2 !
第十个参数为 10 !
第十个参数为 34 !
第十一个参数为 73 !
参数总数有 11 个!
作为一个字符串输出所有参数 1 2 3 4 5 6 7 8 9 34 73 !

### IO重定向
\>为输出流
\>>为不覆盖的输出流
< 、<<为输出
```
echo "IO test" > test0728
```
执行后，生成test0728文件，文件内容为：
> IO test

需要注意的是文件描述符:
0通常是标准输入（STDIN）,1是标准输出（STDOUT）,2是标准错误输出（STDERR）。
像在Android中常用的编译命令：
```
make -j8 2>&1 | tee build.log 
```
2是标准错误，&1是标准输出，2>&1意思就是将标准错误输出到标准输出中。
如果没有2>&1,只会有标准输出，没有错误；
tee的作用同时输出到控制台和文件
make > build.log  是将所有标准输出到这个文件中，并没有定义标准错误应该是定义到了标准输出，也就是说如果make执行出现错误，那么就不会写到 build.log中，而是输出到屏幕上，
2>&1是错误和结果都重定向到build.log中！
最后可以到根目录看到 build.log





  [1]: https://zh.wikipedia.org/wiki/Shell%E8%84%9A%E6%9C%AC
  [2]: https://zh.wikipedia.org/wiki/Shell%E8%84%9A%E6%9C%AC

